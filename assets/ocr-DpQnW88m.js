var N=Object.defineProperty;var k=(o,r,a)=>r in o?N(o,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[r]=a;var f=(o,r,a)=>k(o,typeof r!="symbol"?r+"":r,a);import{a as n,p as e,w}from"./chunk-B7RQU5TL-xj-QjgGV.js";import{u as C}from"./MathpixSettingsContext-C5kfmVKl.js";import{W as R}from"./react-webcam-Cv0vQhem.js";import{u as M}from"./CameraSettingsContext-BDn7_6_x.js";class b{static async processImage(r,a){var l,u,d,c,x,s;try{if(!a.appId||!a.appKey)throw new Error("App ID y App Key son requeridos");const t=new FormData;t.append("file",r);const m={include_math:a.includeMath??!0,include_latex:((l=a.outputFormats)==null?void 0:l.includes("latex"))??!0,include_mathml:((u=a.outputFormats)==null?void 0:u.includes("mathml"))??!0,include_text:((d=a.outputFormats)==null?void 0:d.includes("text"))??!0};Object.entries(m).forEach(([v,j])=>{t.append(v,j.toString())});const h=`${this.API_BASE_URL}/text`,p={app_id:a.appId,app_key:a.appKey},i=await fetch(h,{method:"POST",headers:p,body:t});let y;const g=i.headers.get("content-type");return g&&g.includes("application/json")?y=await i.json():y=await i.text(),{status:i.status,data:y,error:i.ok?void 0:`Error ${i.status}: ${i.statusText}`,request:{url:h,method:"POST",headers:p,body:t,parameters:{file:{name:r.name,size:r.size,type:r.type},...m}}}}catch(t){return console.error("Error processing image with Mathpix:",t),{status:0,data:null,error:t instanceof Error?t.message:"Error desconocido",request:{url:`${this.API_BASE_URL}/text`,method:"POST",headers:{app_id:a.appId,app_key:a.appKey},body:new FormData,parameters:{file:{name:r.name,size:r.size,type:r.type},include_math:a.includeMath??!0,include_latex:((c=a.outputFormats)==null?void 0:c.includes("latex"))??!0,include_mathml:((x=a.outputFormats)==null?void 0:x.includes("mathml"))??!0,include_text:((s=a.outputFormats)==null?void 0:s.includes("text"))??!0}}}}}static validateImageFile(r){if(!["image/jpeg","image/jpg","image/png","image/gif","image/bmp","image/webp","application/pdf"].includes(r.type))return{valid:!1,error:"Tipo de archivo no soportado. Use JPG, PNG, GIF, BMP, WebP o PDF."};const l=10*1024*1024;return r.size>l?{valid:!1,error:"El archivo es demasiado grande. Máximo 10MB."}:{valid:!0}}static formatResponseData(r){return typeof r=="string"?r:typeof r=="object"&&r!==null?JSON.stringify(r,null,2):String(r)}}f(b,"API_BASE_URL","https://api.mathpix.com/v3");function S({onFileSelect:o,isProcessing:r,disabled:a=!1}){const l=n.useRef(null),u=n.useCallback(t=>{var h;const m=(h=t.target.files)==null?void 0:h[0];m&&o(m)},[o]),d=n.useCallback(t=>{if(t.preventDefault(),t.stopPropagation(),a||r)return;const m=t.dataTransfer.files[0];m&&o(m)},[o,a,r]),c=n.useCallback(t=>{t.preventDefault(),t.stopPropagation()},[]),x=n.useCallback(()=>{!a&&!r&&l.current&&l.current.click()},[a,r]),s=a||r;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Subir Imagen"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors duration-200 ${s?"border-gray-300 dark:border-gray-600 cursor-not-allowed opacity-50":"border-gray-300 dark:border-gray-600 hover:border-blue-400 dark:hover:border-blue-500 cursor-pointer"}`,onDrop:d,onDragOver:c,onClick:x,children:[e.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${s?"bg-gray-100 dark:bg-gray-700":"bg-blue-100 dark:bg-blue-900/30"}`,children:e.jsx("svg",{className:`w-8 h-8 ${s?"text-gray-400":"text-blue-600 dark:text-blue-400"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:`text-lg font-medium mb-2 ${s?"text-gray-400":""}`,style:{color:s?"var(--color-text-secondary)":"var(--color-text-primary)"},children:r?"Procesando...":"Arrastra una imagen aquí o haz clic para seleccionar"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"Soporta JPG, PNG, GIF, BMP, WebP y PDF (máximo 10MB)"}),e.jsx("button",{className:`px-6 py-2 rounded-lg transition-colors duration-200 ${s?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,disabled:s,type:"button",children:r?"Procesando...":"Seleccionar Archivo"})]}),e.jsx("input",{ref:l,type:"file",accept:"image/*,.pdf",onChange:u,className:"hidden",disabled:s})]})}function E({onImageCapture:o,isProcessing:r,disabled:a=!1}){const l=n.useRef(null),[u,d]=n.useState(null),[c,x]=n.useState(!1),{settings:s}=M(),t={width:s.videoConstraints.width,height:s.videoConstraints.height,facingMode:s.videoConstraints.facingMode},m=n.useCallback(async()=>{if(!(!l.current||a||r||c)){x(!0),d(null);try{await new Promise(i=>setTimeout(i,s.focusDelay*1e3));const p=l.current.getScreenshot({width:s.videoConstraints.width,height:s.videoConstraints.height});if(p){const y=await(await fetch(p)).blob(),g=new File([y],`camera-capture-${Date.now()}.${s.screenshotFormat.split("/")[1]}`,{type:s.screenshotFormat});o(g)}}catch(p){d("Error al capturar la imagen"),console.error("Error capturing image:",p)}finally{x(!1)}}},[s,o,a,r,c]),h=a||r||c;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Capturar con Cámara"}),u&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-md",children:u}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{ref:l,audio:!1,videoConstraints:t,className:`w-full h-auto rounded-lg ${h?"opacity-50":""}`,style:{maxHeight:"60vh"},onUserMediaError:p=>{d("Error al acceder a la cámara. Verifica los permisos."),console.error("Webcam error:",p)}}),(c||r)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:c?"Enfocando...":"Procesando..."})]})})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:m,disabled:h,className:`px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:c?"Enfocando...":r?"Procesando...":"Capturar y Procesar"})}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{children:["Resolución: ",s.videoConstraints.width,"x",s.videoConstraints.height]}),e.jsxs("div",{children:["Cámara: ",s.videoConstraints.facingMode==="environment"?"Trasera":"Frontal"]}),e.jsxs("div",{children:["Formato: ",s.screenshotFormat]}),e.jsxs("div",{children:["Calidad: ",s.screenshotQuality]}),e.jsxs("div",{children:["Delay: ",s.focusDelay,"s"]})]})})]})}function I({result:o,isProcessing:r,selectedFile:a,error:l,onClearResult:u,onClearError:d}){const c=t=>t>=200&&t<300?"text-green-600 dark:text-green-400":t>=400&&t<500?"text-yellow-600 dark:text-yellow-400":t>=500?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400",x=t=>t>=200&&t<300?"✅":t>=400&&t<500?"⚠️":t>=500?"❌":"❓",s=t=>typeof t=="string"?t:typeof t=="object"&&t!==null?JSON.stringify(t,null,2):String(t);return r?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Procesando Imagen"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center animate-spin",style:{backgroundColor:"var(--color-accent)"},children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Analizando imagen con Mathpix..."}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:a==null?void 0:a.name})]})]}):l?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Error en el Procesamiento"}),e.jsx("button",{onClick:d,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors duration-200",children:"Cerrar"})]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-5 h-5 text-red-600 dark:text-red-400 mt-0.5",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:l})]})]})})]}):o?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--color-text-primary)"},children:"Resultados del OCR"}),e.jsx("button",{onClick:u,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors duration-200",children:"Limpiar"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Status Code:"}),e.jsxs("span",{className:`text-sm font-mono px-2 py-1 rounded ${c(o.status)}`,children:[x(o.status)," ",o.status]})]})}),o.request&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Información de la Request:"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 space-y-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"URL:"}),e.jsxs("span",{className:"text-xs font-mono text-blue-600 dark:text-blue-400 break-all",children:[o.request.method," ",o.request.url]})]})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 block mb-1",children:"Headers:"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded p-2",children:e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap",style:{color:"var(--color-text-secondary)"},children:JSON.stringify(o.request.headers,null,2)})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 block mb-1",children:"Parámetros:"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded p-2",children:e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap",style:{color:"var(--color-text-secondary)"},children:JSON.stringify(o.request.parameters,null,2)})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Respuesta de la API:"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto max-h-96",children:e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap",style:{color:"var(--color-text-secondary)"},children:s(o.data)})})]}),a&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm",style:{color:"var(--color-text-secondary)"},children:[e.jsx("span",{children:"Archivo procesado:"}),e.jsx("span",{className:"font-medium",children:a.name}),e.jsxs("span",{children:["(",(a.size/1024).toFixed(1)," KB)"]})]})})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Resultados del OCR"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center bg-gray-100 dark:bg-gray-700",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"Los resultados del reconocimiento aparecerán aquí"}),e.jsx("div",{className:"text-xs px-3 py-1 rounded-full inline-block bg-gray-100 dark:bg-gray-700",style:{color:"var(--color-text-secondary)"},children:"Sube una imagen para empezar"})]})]})}function _({}){return[{title:"OCR - Mathpix Explorer"},{name:"description",content:"Explorador de la API de OCR de Mathpix para reconocimiento de texto y fórmulas matemáticas"}]}const T=w(function(){const{settings:r}=C(),[a,l]=n.useState(!1),[u,d]=n.useState(null),[c,x]=n.useState(null),[s,t]=n.useState(null),m=n.useCallback(async i=>{const y=b.validateImageFile(i);if(!y.valid){t(y.error||"Archivo inválido"),l(!1);return}if(!r.appId||!r.appKey){t("Configuración de Mathpix incompleta. Ve a Configuración para agregar tus credenciales."),l(!1);return}l(!0),t(null),x(i),d(null);try{const g=await b.processImage(i,{appId:r.appId,appKey:r.appKey,includeMath:r.includeMath,outputFormats:r.outputFormats});d(g),l(!1),t(g.error||null)}catch(g){l(!1),t(g instanceof Error?g.message:"Error desconocido")}},[r]),h=n.useCallback(()=>{d(null),x(null),t(null)},[]),p=n.useCallback(()=>{t(null)},[]);return e.jsxs("div",{className:"min-h-screen pb-20",style:{backgroundColor:"var(--color-background)"},children:[e.jsxs("div",{className:"shadow-sm border-b px-4 py-4",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)"},children:[e.jsx("h1",{className:"text-xl font-semibold",style:{color:"var(--color-text-primary)"},children:"🔍 OCR Explorer"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Reconocimiento de texto y fórmulas matemáticas con Mathpix API"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(S,{onFileSelect:m,isProcessing:a}),e.jsx(E,{onImageCapture:m,isProcessing:a}),e.jsx(I,{result:u,isProcessing:a,selectedFile:c,error:s,onClearResult:h,onClearError:p}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",style:{color:"var(--color-text-primary)"},children:"Características de Mathpix OCR"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-accent)"},children:e.jsx("span",{className:"text-white text-sm",children:"📝"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:"Reconocimiento de Texto"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Extrae texto de imágenes con alta precisión"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-accent)"},children:e.jsx("span",{className:"text-white text-sm",children:"🧮"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:"Fórmulas Matemáticas"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Convierte ecuaciones a LaTeX y MathML"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-accent)"},children:e.jsx("span",{className:"text-white text-sm",children:"📊"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:"Múltiples Formatos"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Texto, LaTeX, MathML y más"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-surface)"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-accent)"},children:e.jsx("span",{className:"text-white text-sm",children:"⚡"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:"Procesamiento Rápido"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Resultados en segundos"})]})]})]})]})]})]})});export{T as default,_ as meta};
